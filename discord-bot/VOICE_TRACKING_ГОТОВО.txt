═══════════════════════════════════════════════════════════
✅ ОТСЛЕЖИВАНИЕ ВОЙСОВ ГОТОВО
═══════════════════════════════════════════════════════════

📅 Дата: 02.02.2026
✅ Статус: ИНТЕГРИРОВАНО В БОТА

═══════════════════════════════════════════════════════════

✅ ЧТО СДЕЛАНО:

1. ✅ ИМПОРТ МОДУЛЯ
   └─ Добавлен: import voice_tracking в bot.py

2. ✅ ОБРАБОТЧИК СОБЫТИЙ
   └─ Добавлен: on_voice_state_update
   └─ Отслеживает вход/выход/переключение каналов

3. ✅ КОМАНДА !top voice
   └─ Показывает топ-10 по времени в войсе
   └─ Топ-3 самых активных каналов
   └─ Рекорд самой длительной сессии

4. ✅ ОБНОВЛЁН СПИСОК КОМАНД
   └─ !top [xp/voice] - таблица лидеров

═══════════════════════════════════════════════════════════

🎤 КАК ИСПОЛЬЗОВАТЬ:

КОМАНДЫ:
├─ !top          - топ по XP (по умолчанию)
├─ !top xp       - топ по XP
└─ !top voice    - топ по времени в войсе

═══════════════════════════════════════════════════════════

📊 ЧТО ПОКАЗЫВАЕТ !top voice:

1. ТОП-10 ПОЛЬЗОВАТЕЛЕЙ
   ├─ Имя пользователя
   ├─ Общее время в войсе
   └─ Количество сессий

2. ТОП-3 КАНАЛОВ
   ├─ Название канала
   └─ Общее время активности

3. РЕКОРД СЕССИИ
   ├─ Имя пользователя
   └─ Длительность самой долгой сессии

═══════════════════════════════════════════════════════════

🔧 ТЕХНИЧЕСКИЕ ДЕТАЛИ:

ФАЙЛЫ ИЗМЕНЕНЫ:
├─ py/bot.py ✅
│  ├─ Добавлен импорт: import voice_tracking
│  ├─ Добавлен обработчик: on_voice_state_update
│  └─ Обновлена команда: !top с параметром voice
└─ py/commands_manager.py ✅
   └─ Обновлено описание: !top [xp/voice]

ФАЙЛЫ ИСПОЛЬЗУЮТСЯ:
├─ py/voice_tracking.py ✅ (уже был создан)
└─ json/voice_data.json (создаётся автоматически)

ДАННЫЕ СОХРАНЯЮТСЯ:
├─ Общее время каждого пользователя
├─ Все сессии с временем начала/конца
├─ Общее время каждого канала
└─ Активные сессии (в памяти)

═══════════════════════════════════════════════════════════

🚀 ЗАПУСК:

ШАГ 1: ОСТАНОВИ БОТА
└─ CTRL+C

ШАГ 2: ЗАПУСТИ БОТА
└─ ЗАПУСК.bat

ШАГ 3: ПРОТЕСТИРУЙ
├─ Зайди в войс канал
├─ Подожди немного
├─ Выйди из войса
└─ Напиши !top voice

═══════════════════════════════════════════════════════════

🎮 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:

ПРИМЕР 1: ТОП ПО XP
┌─────────────────────────────────────────────────────────┐
│ Команда: !top                                           │
│                                                         │
│ Результат:                                              │
│ 🏆 топ-10 по xp                                         │
│                                                         │
│ 🥇 Игрок1                                               │
│ ранг: S III | xp: 15000                                 │
│                                                         │
│ 🥈 Игрок2                                               │
│ ранг: A III | xp: 12000                                 │
│                                                         │
│ 🥉 Игрок3                                               │
│ ранг: A II | xp: 10000                                  │
│                                                         │
│ используй !top voice для топа по войсу                  │
└─────────────────────────────────────────────────────────┘

ПРИМЕР 2: ТОП ПО ВОЙСУ
┌─────────────────────────────────────────────────────────┐
│ Команда: !top voice                                     │
│                                                         │
│ Результат:                                              │
│ 🎤 топ-10 по войсу                                      │
│ самые активные в голосовых каналах                      │
│                                                         │
│ 🥇 Игрок1                                               │
│ время: 5ч 30м 15с | сессий: 25                          │
│                                                         │
│ 🥈 Игрок2                                               │
│ время: 4ч 15м 42с | сессий: 18                          │
│                                                         │
│ 🥉 Игрок3                                               │
│ время: 3ч 45м 10с | сессий: 22                          │
│                                                         │
│ 🔥 топ каналов                                          │
│ • Общий: 15ч 20м 30с                                    │
│ • Игровой: 12ч 45м 15с                                  │
│ • Музыка: 8ч 10м 5с                                     │
│                                                         │
│ ⏱️ рекорд сессии                                        │
│ Игрок1: 2ч 30м 45с                                      │
└─────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════

📝 КАК ЭТО РАБОТАЕТ:

1. ВХОД В ВОЙС
   ├─ Бот фиксирует время входа
   ├─ Сохраняет ID канала
   └─ Создаёт активную сессию

2. ВЫХОД ИЗ ВОЙСА
   ├─ Бот вычисляет длительность сессии
   ├─ Добавляет время к общему времени пользователя
   ├─ Добавляет время к общему времени канала
   └─ Сохраняет данные в json/voice_data.json

3. ПЕРЕКЛЮЧЕНИЕ КАНАЛОВ
   ├─ Завершает сессию в старом канале
   └─ Начинает новую сессию в новом канале

4. КОМАНДА !top voice
   ├─ Читает данные из json/voice_data.json
   ├─ Сортирует пользователей по времени
   ├─ Сортирует каналы по активности
   ├─ Находит самую длительную сессию
   └─ Отправляет красивый embed

═══════════════════════════════════════════════════════════

🔍 ОТЛАДКА:

ЕСЛИ НЕ РАБОТАЕТ:

1. Проверь консоль при входе в войс:
   └─ Должно быть: "🎤 [имя] зашёл в [канал]"

2. Проверь консоль при выходе:
   └─ Должно быть: "🎤 [имя] вышел из войса (время: ...)"

3. Проверь файл json/voice_data.json:
   └─ Должен создаться автоматически
   └─ Должен содержать данные о пользователях и каналах

4. Проверь команду !top voice:
   └─ Если нет данных: "❌ нет данных о войс активности"
   └─ Если есть данные: показывает топ

5. Проверь права бота:
   └─ Бот должен видеть голосовые каналы
   └─ Intent: guilds, members должны быть включены

═══════════════════════════════════════════════════════════

✅ ЧЕКЛИСТ:

ПЕРЕД ЗАПУСКОМ:
□ Бот остановлен (CTRL+C)
□ py/bot.py обновлён ✅
□ py/commands_manager.py обновлён ✅
□ py/voice_tracking.py существует ✅
□ Готов запустить ЗАПУСК.bat

ПОСЛЕ ЗАПУСКА:
□ Бот запущен успешно
□ Зашёл в войс канал
□ В консоли: "🎤 [имя] зашёл в [канал]"
□ Вышел из войса
□ В консоли: "🎤 [имя] вышел из войса (время: ...)"
□ Файл json/voice_data.json создан
□ Команда !top voice работает

ТЕСТИРОВАНИЕ:
□ !top - показывает топ по XP
□ !top xp - показывает топ по XP
□ !top voice - показывает топ по войсу
□ Топ по войсу содержит:
  □ Топ-10 пользователей
  □ Топ-3 каналов
  □ Рекорд сессии

═══════════════════════════════════════════════════════════

❓ ЧАСТЫЕ ВОПРОСЫ:

Q: Команда !top voice показывает "нет данных"?
A: Нужно чтобы кто-то зашёл и вышел из войса хотя бы раз

Q: Время не считается?
A: Проверь консоль на сообщения "🎤 зашёл/вышел"

Q: Данные не сохраняются?
A: Проверь что папка json/ существует и бот имеет права на запись

Q: Как сбросить статистику?
A: Удали файл json/voice_data.json

Q: Можно ли посмотреть свою статистику?
A: Пока нет, но можно добавить команду !voicestats

Q: Учитывается ли AFK канал?
A: Да, все каналы учитываются

═══════════════════════════════════════════════════════════

🎉 ВСЁ ГОТОВО!

Отслеживание войсов полностью интегрировано в бота!

═══════════════════════════════════════════════════════════

Дата: 02.02.2026
Автор: Kiro AI Assistant

Удачи! 🚀

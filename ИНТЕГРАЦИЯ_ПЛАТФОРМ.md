# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º TTFD

**–î–∞—Ç–∞:** 08.02.2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:** Telegram Bot + Discord Bot + Website

---

## üéØ –¶–µ–ª—å

–°–≤—è–∑–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
- **Telegram Bot** - –∏–≥—Ä—ã, –∫–æ–º–∞–Ω–¥—ã, XP
- **Discord Bot** - –≤–æ–π—Å, —Å–æ–æ–±—â–µ–Ω–∏—è, —Ä–æ–ª–∏
- **Website** - –ø—Ä–æ—Ñ–∏–ª—å, –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è, –º–∞–≥–∞–∑–∏–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è XP/–º–æ–Ω–µ—Ç/—Ä–∞–Ω–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Unified DB      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  Discord Bot    ‚îÇ
‚îÇ   (Python)      ‚îÇ         ‚îÇ  (PostgreSQL)    ‚îÇ         ‚îÇ   (Python)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚ñ≤
                                     ‚îÇ
                                     ‚ñº
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ    Website      ‚îÇ
                            ‚îÇ   (Flask)       ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```sql
unified_users:
  - id (PK)
  - telegram_id (unique)
  - discord_id (unique)
  - website_email (unique)
  - xp, coins, rank_id
  - games_played, games_won
  - total_voice_time, messages_sent
  - achievements, season_xp
  - platforms (jsonb) - ['telegram', 'discord', 'website']
  - primary_platform
```

---

## üì¶ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. Shared –º–æ–¥—É–ª—å ‚úÖ
**–§–∞–π–ª:** `TTFD/shared/models.py`

- `UnifiedUser` - –µ–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `Rank` - –º–æ–¥–µ–ª—å —Ä–∞–Ω–≥–∞ (20 —Ä–∞–Ω–≥–æ–≤ F-S)
- `UNIFIED_RANKS` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–∞–Ω–≥–æ–≤
- `PlatformLink` - –º–æ–¥–µ–ª—å –ø—Ä–∏–≤—è–∑–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º
- `CrossPlatformEvent` - —Å–æ–±—ã—Ç–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 2. Unified Database ‚úÖ
**–§–∞–π–ª:** `TTFD/shared/database_unified.py`

- `UnifiedDatabase` - –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –ú–µ—Ç–æ–¥—ã:
  - `get_user_by_telegram()` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ Telegram ID
  - `get_user_by_discord()` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ Discord ID
  - `get_user_by_website()` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ Website email
  - `create_user()` - —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `link_telegram/discord/website()` - –ø—Ä–∏–≤—è–∑–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
  - `update_xp()` - –æ–±–Ω–æ–≤–∏—Ç—å XP —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–∞–Ω–≥–∞
  - `update_coins()` - –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–Ω–µ—Ç—ã
  - `create_event()` - —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  - `get_pending_events()` - –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

---

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

```sql
-- –°–æ–∑–¥–∞—Ç—å unified —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE unified_users (
    id SERIAL PRIMARY KEY,
    telegram_id TEXT UNIQUE,
    discord_id TEXT UNIQUE,
    website_email TEXT UNIQUE,
    username TEXT NOT NULL DEFAULT 'Unknown',
    display_name TEXT NOT NULL DEFAULT 'Unknown',
    xp INTEGER NOT NULL DEFAULT 0,
    coins INTEGER NOT NULL DEFAULT 0,
    rank_id INTEGER NOT NULL DEFAULT 1,
    games_played INTEGER NOT NULL DEFAULT 0,
    games_won INTEGER NOT NULL DEFAULT 0,
    total_voice_time INTEGER NOT NULL DEFAULT 0,
    messages_sent INTEGER NOT NULL DEFAULT 0,
    achievements JSONB DEFAULT '[]'::jsonb,
    current_season_xp INTEGER NOT NULL DEFAULT 0,
    season_rank INTEGER NOT NULL DEFAULT 0,
    daily_streak INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_active TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_daily TIMESTAMP,
    platforms JSONB DEFAULT '[]'::jsonb,
    primary_platform TEXT NOT NULL DEFAULT 'telegram',
    CONSTRAINT check_at_least_one_platform CHECK (
        telegram_id IS NOT NULL OR 
        discord_id IS NOT NULL OR 
        website_email IS NOT NULL
    )
);

CREATE INDEX idx_unified_users_telegram ON unified_users(telegram_id);
CREATE INDEX idx_unified_users_discord ON unified_users(discord_id);
CREATE INDEX idx_unified_users_website ON unified_users(website_email);
CREATE INDEX idx_unified_users_xp ON unified_users(xp DESC);

CREATE TABLE cross_platform_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id INTEGER NOT NULL REFERENCES unified_users(id) ON DELETE CASCADE,
    event_type TEXT NOT NULL,
    source_platform TEXT NOT NULL,
    data JSONB NOT NULL,
    processed BOOLEAN NOT NULL DEFAULT FALSE,
    processed_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_cross_platform_events_user ON cross_platform_events(user_id);
CREATE INDEX idx_cross_platform_events_processed ON cross_platform_events(processed);
```

### –®–∞–≥ 2: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏: TTFD/shared/migrate_to_unified.py

import asyncio
from database_unified import get_unified_db

async def migrate_telegram_users():
    """–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Telegram Bot"""
    db = await get_unified_db()
    
    # –ß–∏—Ç–∞–µ–º –∏–∑ —Å—Ç–∞—Ä–æ–π –ë–î Telegram
    # –°–æ–∑–¥–∞—ë–º –≤ unified_users
    # ...

async def migrate_discord_users():
    """–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Discord Bot"""
    # ...

async def migrate_website_users():
    """–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ Website"""
    # ...

# –ó–∞–ø—É—Å–∫
asyncio.run(migrate_telegram_users())
asyncio.run(migrate_discord_users())
asyncio.run(migrate_website_users())
```

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Telegram Bot

```python
# –í TTFD/telegram-bot/main_v3.py

# –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
import sys
sys.path.append('../shared')
from database_unified import get_unified_db

# –í async def main():
# –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
unified_db = await get_unified_db()

# –û–±–Ω–æ–≤–∏—Ç—å UserService –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è unified_db
# ...
```

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Discord Bot

```python
# –í TTFD-Discord/py/bot.py

# –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
import sys
sys.path.append('../../shared')
from database_unified import get_unified_db

# –í on_ready():
global unified_db
unified_db = await get_unified_db()

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è unified_db
# ...
```

### –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Website

```python
# –í TTFD-Website/app.py

# –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç
import sys
sys.path.append('../shared')
from database_unified import UnifiedDatabase
import asyncio

# –°–æ–∑–¥–∞—Ç—å unified_db
database_url = os.getenv('DATABASE_URL')
unified_db = UnifiedDatabase(database_url)

# –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è async –≤—ã–∑–æ–≤–æ–≤
def run_async(coro):
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    return loop.run_until_complete(coro)

# –í —Ä–æ—É—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
@app.route('/api/profile')
def api_profile():
    user = run_async(unified_db.get_user_by_website(email))
    return jsonify(user.to_dict())
```

---

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Telegram

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç /start –≤ Telegram
telegram_id = str(update.effective_user.id)
username = update.effective_user.username

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
user = await unified_db.get_user_by_telegram(telegram_id)

if not user:
    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ
    user = await unified_db.create_user(
        telegram_id=telegram_id,
        username=username,
        display_name=update.effective_user.first_name,
        primary_platform='telegram'
    )
    
    await update.message.reply_text(
        f"üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user.display_name}!\n"
        f"üéÆ –¢–≤–æ–π ID: {user.id}\n"
        f"üí° –ü—Ä–∏–≤—è–∂–∏ Discord –∏ Website –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø—ã—Ç–∞!"
    )
```

### 2. –ü—Ä–∏–≤—è–∑–∫–∞ Discord –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É

```python
# –í Discord: /link <telegram_id>
@bot.tree.command(name="link")
async def link_telegram(interaction, telegram_id: str):
    discord_id = str(interaction.user.id)
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram
    user = await unified_db.get_user_by_telegram(telegram_id)
    
    if not user:
        await interaction.response.send_message("‚ùå Telegram –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    # –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º Discord
    success = await unified_db.link_discord(user.id, discord_id)
    
    if success:
        await interaction.response.send_message(
            f"‚úÖ Discord –ø—Ä–∏–≤—è–∑–∞–Ω!\n"
            f"üéÆ –¢–≤–æ–π –µ–¥–∏–Ω—ã–π ID: {user.id}\n"
            f"üìä XP: {user.xp} | –ú–æ–Ω–µ—Ç—ã: {user.coins}"
        )
    else:
        await interaction.response.send_message("‚ùå Discord —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É")
```

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è XP –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç XP –≤ Telegram (–∏–≥—Ä–∞)
result = await unified_db.update_xp(user.id, delta_xp=50)

if result['rank_up']:
    # –°–æ–∑–¥–∞—ë–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
    await unified_db.create_event(
        user_id=user.id,
        event_type='rank_up',
        source_platform='telegram',
        data={
            'old_rank': result['old_rank'],
            'new_rank': result['new_rank'],
            'reward_coins': result['reward_coins']
        }
    )
    
    # Discord Bot –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∏ –æ–±–Ω–æ–≤–∏—Ç —Ä–æ–ª—å
    # Website –ø–æ–∫–∞–∂–µ—Ç –Ω–æ–≤—ã–π —Ä–∞–Ω–≥ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
```

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞ Website

```python
# Website: /profile
@app.route('/profile')
def profile():
    # –ü–æ–ª—É—á–∞–µ–º email –∏–∑ —Å–µ—Å—Å–∏–∏
    email = session.get('email')
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user = run_async(unified_db.get_user_by_website(email))
    
    if not user:
        return redirect('/login')
    
    # –†–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–æ—Ñ–∏–ª—å
    return render_template('profile.html', 
        user=user.to_dict(),
        linked_platforms={
            'telegram': user.is_linked_telegram,
            'discord': user.is_linked_discord,
            'website': user.is_linked_website
        }
    )
```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- ‚úÖ –û–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
- ‚úÖ XP/–º–æ–Ω–µ—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ò–≥—Ä–∞–π –≥–¥–µ —É–¥–æ–±–Ω–æ - –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤–µ–∑–¥–µ
- ‚úÖ –ï–¥–∏–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- ‚úÖ –ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–Ω–≥–æ–≤
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

---

## üîß API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### REST API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
# TTFD/shared/api.py - FastAPI —Å–µ—Ä–≤–µ—Ä

from fastapi import FastAPI, HTTPException
from database_unified import get_unified_db

app = FastAPI()

@app.get("/api/user/{platform}/{platform_id}")
async def get_user(platform: str, platform_id: str):
    """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ"""
    db = await get_unified_db()
    
    if platform == 'telegram':
        user = await db.get_user_by_telegram(platform_id)
    elif platform == 'discord':
        user = await db.get_user_by_discord(platform_id)
    elif platform == 'website':
        user = await db.get_user_by_website(platform_id)
    else:
        raise HTTPException(400, "Invalid platform")
    
    if not user:
        raise HTTPException(404, "User not found")
    
    return user.to_dict()

@app.post("/api/user/{user_id}/xp")
async def add_xp(user_id: int, delta_xp: int, source: str):
    """–î–æ–±–∞–≤–∏—Ç—å XP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    db = await get_unified_db()
    result = await db.update_xp(user_id, delta_xp)
    
    # –°–æ–∑–¥–∞—ë–º —Å–æ–±—ã—Ç–∏–µ
    if result['rank_up']:
        await db.create_event(
            user_id=user_id,
            event_type='rank_up',
            source_platform=source,
            data=result
        )
    
    return result

# –ó–∞–ø—É—Å–∫: uvicorn api:app --host 0.0.0.0 --port 8000
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (2 —á–∞—Å–∞)
1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram Bot (1 —á–∞—Å)
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å unified_db
2. –û–±–Ω–æ–≤–∏—Ç—å UserService
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Discord Bot (1 —á–∞—Å)
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å unified_db
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Website (1 —á–∞—Å)
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å unified_db
2. –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç—ã
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (2 —á–∞—Å–∞)
1. –°–æ–∑–¥–∞—Ç—å –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –≥–æ—Ç–æ–≤—ã. –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –ø–æ —à–∞–≥–∞–º.

**–í—Ä–µ–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** ~7 —á–∞—Å–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–∞–Ω–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ TTFD


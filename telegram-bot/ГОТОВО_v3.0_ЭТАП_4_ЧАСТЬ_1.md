# ‚úÖ –ì–û–¢–û–í–û: –≠—Ç–∞–ø 4 (–ß–∞—Å—Ç—å 1) - –ò–≥—Ä—ã

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ú–æ–¥–µ–ª–∏ –∏–≥—Ä
**–§–∞–π–ª:** `domain/models/game.py`

- **GameType** enum (guess_number, quiz, spin)
- **GameStatus** enum (in_progress, won, lost, cancelled)
- **GameSession** - —Å–µ—Å—Å–∏—è –∏–≥—Ä—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- **GameStats** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **QUIZ_QUESTIONS** - 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–≤–∏–∑–∞
- **SPIN_REWARDS** - 7 –Ω–∞–≥—Ä–∞–¥ –¥–ª—è —Å–ø–∏–Ω–∞ —Å –≤–µ—Å–∞–º–∏

### 2. GameRepository
**–§–∞–π–ª:** `infrastructure/database/repositories/game_repository.py`

**–ú–µ—Ç–æ–¥—ã:**
- `create_session()` - —Å–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–≤—É—é —Å–µ—Å—Å–∏—é
- `complete_session()` - –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
- `get_session()` - –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é –ø–æ ID
- `get_user_sessions()` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_user_stats()` - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä
- `get_leaderboard()` - —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ –∏–≥—Ä–∞–º

### 3. GameService
**–§–∞–π–ª:** `domain/services/game_service.py`

#### –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ
- `start_guess_game()` - –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É (—Å–Ω—è—Ç—å —Å—Ç–∞–≤–∫—É, —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é)
- `check_guess()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ
- `cancel_guess_game()` - –æ—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É (–≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞–≤–∫—É)

**–ú–µ—Ö–∞–Ω–∏–∫–∞:**
- –ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10
- –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 3
- –ü—Ä–æ–∏–≥—Ä—ã—à: —É—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π XP (5)

#### –ö–≤–∏–∑
- `get_random_quiz()` - —Å–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- `start_quiz_game()` - –Ω–∞—á–∞—Ç—å –∫–≤–∏–∑
- `check_quiz_answer()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
- `cancel_quiz_game()` - –æ—Ç–º–µ–Ω–∏—Ç—å –∫–≤–∏–∑

**–ú–µ—Ö–∞–Ω–∏–∫–∞:**
- 10 –≤–æ–ø—Ä–æ—Å–æ–≤
- –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 2
- –ü—Ä–æ–∏–≥—Ä—ã—à: —É—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π XP (5)

#### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω
- `can_spin()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—É–ª–¥–∞—É–Ω (24 —á–∞—Å–∞)
- `spin_wheel()` - –∫—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ

**–ú–µ—Ö–∞–Ω–∏–∫–∞:**
- 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞
- 7 –Ω–∞–≥—Ä–∞–¥ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
- –û—Ç 10 –¥–æ 500 –º–æ–Ω–µ—Ç + XP

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `get_user_stats()` - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_leaderboard()` - —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤

### 4. Handlers

#### GamesMenuHandler
**–§–∞–π–ª:** `application/handlers/games/games_menu_handler.py`

- `/games` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–≥—Ä
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –∏ XP
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä

#### GuessGameHandler
**–§–∞–π–ª:** `application/handlers/games/guess_handler.py`

- –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏ (10, 25, 50, 100)
- –í—ã–±–æ—Ä —á–∏—Å–ª–∞ (1-10)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –û—Ç–º–µ–Ω–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ç–∞–≤–∫–∏

#### QuizHandler
**–§–∞–π–ª:** `application/handlers/games/quiz_handler.py`

- –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏
- –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
- –û—Ç–º–µ–Ω–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ç–∞–≤–∫–∏

#### SpinHandler
**–§–∞–π–ª:** `application/handlers/games/spin_handler.py`

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
- –ö—Ä—É—Ç–∏—Ç—å —Å–ø–∏–Ω
- –ü–æ–∫–∞–∑ –Ω–∞–≥—Ä–∞–¥—ã

### 5. SQL –º–∏–≥—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `infrastructure/database/migrations/002_update_game_history.sql`

–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `game_history`:
- id, user_id, game_type
- bet_amount, status, result (JSONB)
- reward_coins, reward_xp
- created_at, completed_at
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 8  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~1200  
**–ò–≥—Ä:** 3 (–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ, –ö–≤–∏–∑, –°–ø–∏–Ω)  
**–í–æ–ø—Ä–æ—Å–æ–≤ –∫–≤–∏–∑–∞:** 10  
**–ù–∞–≥—Ä–∞–¥ —Å–ø–∏–Ω–∞:** 7  
**Handlers:** 4  

---

## üéÆ –ò–≥—Ä—ã

### üé≤ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ
- –ó–∞–≥–∞–¥–∞–Ω–æ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10
- –°—Ç–∞–≤–∫–∏: 10, 25, 50, 100 –º–æ–Ω–µ—Ç
- –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 3
- –ü—Ä–æ–∏–≥—Ä—ã—à: —É—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π XP

### üß† –ö–≤–∏–∑
- 10 —Ä–∞–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- –°—Ç–∞–≤–∫–∏: 10, 25, 50, 100 –º–æ–Ω–µ—Ç
- –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 2
- –ü—Ä–æ–∏–≥—Ä—ã—à: —É—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π XP

### üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω
- 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ù–∞–≥—Ä–∞–¥—ã:
  - üí∞ 10 –º–æ–Ω–µ—Ç (30% —à–∞–Ω—Å)
  - üí∞ 25 –º–æ–Ω–µ—Ç (25%)
  - üí∞ 50 –º–æ–Ω–µ—Ç (20%)
  - üí∞ 100 –º–æ–Ω–µ—Ç (15%)
  - üíé 50 XP (5%)
  - üéÅ 200 –º–æ–Ω–µ—Ç (3%)
  - üéâ –î–ñ–ï–ö–ü–û–¢ 500 –º–æ–Ω–µ—Ç (2%)

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```bash
psql -U postgres -d ttfd_bot -f infrastructure/database/migrations/002_update_game_history.sql
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
python main_v3.py
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—ã
```
/games - –º–µ–Ω—é –∏–≥—Ä

# –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ
–í—ã–±—Ä–∞—Ç—å "üé≤ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ"
–í—ã–±—Ä–∞—Ç—å —Å—Ç–∞–≤–∫—É
–í—ã–±—Ä–∞—Ç—å —á–∏—Å–ª–æ
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# –ö–≤–∏–∑
–í—ã–±—Ä–∞—Ç—å "üß† –ö–≤–∏–∑"
–í—ã–±—Ä–∞—Ç—å —Å—Ç–∞–≤–∫—É
–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

# –°–ø–∏–Ω
–í—ã–±—Ä–∞—Ç—å "üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω"
–ö—Ä—É—Ç–∏—Ç—å
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—É–ª–¥–∞—É–Ω)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–í—ã–±—Ä–∞—Ç—å "üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
domain/
  models/
    game.py                    # –ú–æ–¥–µ–ª–∏ –∏–≥—Ä
  services/
    game_service.py            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–≥—Ä

infrastructure/
  database/
    repositories/
      game_repository.py       # Repository –¥–ª—è –∏–≥—Ä
    migrations/
      002_update_game_history.sql  # SQL –º–∏–≥—Ä–∞—Ü–∏—è

application/
  handlers/
    games/
      __init__.py
      games_menu_handler.py    # –ú–µ–Ω—é –∏–≥—Ä
      guess_handler.py         # –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ
      quiz_handler.py          # –ö–≤–∏–∑
      spin_handler.py          # –°–ø–∏–Ω
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ß–∞—Å—Ç—å 2 - –¢–∏–∫–µ—Ç—ã)

- [ ] Ticket models
- [ ] TicketRepository
- [ ] TicketService
- [ ] TicketHandler
- [ ] FSM –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–∏–∫–µ—Ç–æ–≤
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

**–î–∞—Ç–∞:** 08.02.2026  
**–í–µ—Ä—Å–∏—è:** v3.0  
**–≠—Ç–∞–ø:** 4 (–ß–∞—Å—Ç—å 1) –∏–∑ 5  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–≥—Ä—ã –≥–æ—Ç–æ–≤—ã  
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 70% (3.5 –∏–∑ 5 —ç—Ç–∞–ø–æ–≤)

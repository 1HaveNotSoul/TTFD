# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞ —Å Discord

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

Telegram –±–æ—Ç –º–æ–∂–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å Discord –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ –æ–±—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–µ–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –û–±—â–∏–µ XP, –º–æ–Ω–µ—Ç—ã, —Ä–∞–Ω–≥–∏
- –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

**–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**
1. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±–µ –ë–î –Ω–∞ PostgreSQL
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –ë–î –¥–ª—è –æ–±–æ–∏—Ö –±–æ—Ç–æ–≤
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `discord_id` –∏ `telegram_id`

### –í–∞—Ä–∏–∞–Ω—Ç 2: API –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–æ—Ç—ã
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ë–î

**–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å REST API –Ω–∞ Flask/FastAPI
2. Discord –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ API
3. Telegram –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ API

### –í–∞—Ä–∏–∞–Ω—Ç 3: Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö
- –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

**–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**
1. Discord –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö
2. Telegram –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ—é –ë–î

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–°–µ–π—á–∞—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤**:

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç Discord
/link 123456789012345678

# –í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
{
  "telegram_id": "123456789",
  "discord_id": "123456789012345678",
  ...
}
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è XP

```python
# –í Discord –±–æ—Ç–µ –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ XP
def add_xp(discord_id, amount):
    # –î–æ–±–∞–≤–ª—è–µ–º XP –≤ Discord –ë–î
    discord_db.add_xp(discord_id, amount)
    
    # –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π Telegram –∞–∫–∫–∞—É–Ω—Ç
    telegram_id = get_linked_telegram(discord_id)
    if telegram_id:
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Telegram –ë–î
        telegram_db.add_xp(telegram_id, amount)
```

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–Ω–µ—Ç

```python
# –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ XP
def add_coins(discord_id, amount):
    discord_db.add_coins(discord_id, amount)
    telegram_id = get_linked_telegram(discord_id)
    if telegram_id:
        telegram_db.add_coins(telegram_id, amount)
```

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–∞–Ω–≥–∞—Ö

```python
# –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–Ω–≥–∞ –≤ Discord
async def on_rank_up(discord_id, new_rank):
    telegram_id = get_linked_telegram(discord_id)
    if telegram_id:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        await telegram_bot.send_message(
            telegram_id,
            f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –¥–æ—Å—Ç–∏–≥ —Ä–∞–Ω–≥–∞ {new_rank}!"
        )
```

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Discord –±–æ—Ç (TTFD-Discord/main.py)

```python
import requests

TELEGRAM_API_URL = "http://localhost:5000/api"

def sync_with_telegram(discord_id, action, data):
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º"""
    try:
        response = requests.post(
            f"{TELEGRAM_API_URL}/sync",
            json={
                "discord_id": discord_id,
                "action": action,
                "data": data
            }
        )
        return response.json()
    except:
        return None

# –ü—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ XP
def add_xp(user_id, amount):
    # Discord –ë–î
    db.add_xp(user_id, amount)
    
    # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Telegram
    sync_with_telegram(user_id, "add_xp", {"amount": amount})
```

### Telegram –±–æ—Ç (TTFD-Telegram/api.py)

```python
from flask import Flask, request, jsonify
from database import db

app = Flask(__name__)

@app.route('/api/sync', methods=['POST'])
def sync():
    """API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Discord"""
    data = request.json
    discord_id = data['discord_id']
    action = data['action']
    
    # –ù–∞—Ö–æ–¥–∏–º –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π Telegram –∞–∫–∫–∞—É–Ω—Ç
    telegram_id = find_telegram_by_discord(discord_id)
    
    if not telegram_id:
        return jsonify({"error": "Not linked"}), 404
    
    if action == "add_xp":
        db.add_xp(telegram_id, data['data']['amount'])
    elif action == "add_coins":
        db.add_coins(telegram_id, data['data']['amount'])
    
    return jsonify({"success": True})

def find_telegram_by_discord(discord_id):
    """–ù–∞–π—Ç–∏ Telegram ID –ø–æ Discord ID"""
    for user in db.get_all_users():
        if user.get('discord_id') == str(discord_id):
            return user['telegram_id']
    return None
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ** - —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑—É–π –ø—Ä–∏–≤—è–∑–∫—É –∞–∫–∫–∞—É–Ω—Ç–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑—É–π PostgreSQL** - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ë–î
3. **–î–æ–±–∞–≤—å API** - —Å–æ–∑–¥–∞–π REST API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. **Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —á—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –æ–¥–∏–Ω –±–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π API –∫–ª—é—á–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã API
- –í–∞–ª–∏–¥–∏—Ä—É–π –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏—Ä—É–π –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü—Ä–∏–≤—è–∂–∏ –∞–∫–∫–∞—É–Ω—Ç —á–µ—Ä–µ–∑ `/link`
2. –ù–∞—á–∏—Å–ª–∏ XP –≤ Discord
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ XP –ø–æ—è–≤–∏–ª—Å—è –≤ Telegram
4. –ü—Ä–æ–≤–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å:** –ë–∞–∑–æ–≤–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é XP –∏ –º–æ–Ω–µ—Ç

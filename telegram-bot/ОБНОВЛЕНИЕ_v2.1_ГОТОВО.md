# ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ v2.1 - –ì–û–¢–û–í–û!

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### üé´ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ç–∏–∫–µ—Ç-—Å–∏—Å—Ç–µ–º–∞ —Å FSM

**–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞:
  1. –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–û–±—â–∏–π, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –ñ–∞–ª–æ–±–∞)
  2. –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è 10-1000 —Å–∏–º–≤–æ–ª–æ–≤)
  3. –í—ã–±–æ—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (–ù–∏–∑–∫–∏–π, –°—Ä–µ–¥–Ω–∏–π, –í—ã—Å–æ–∫–∏–π)
  4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö —Ç–∏–∫–µ—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –û—Ç–≤–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ç
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –∞–¥–º–∏–Ω–∞

**–î–ª—è –∞–¥–º–∏–Ω–æ–≤:**
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–∏–∫–µ—Ç–æ–≤ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –§–∏–ª—å—Ç—Ä—ã: –æ—Ç–∫—Ä—ã—Ç—ã–µ, –≤ —Ä–∞–±–æ—Ç–µ, –∑–∞–∫—Ä—ã—Ç—ã–µ, –≤—Å–µ
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∏–∫–µ—Ç–∞ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- "–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É" - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ —Å–µ–±–µ
- –û—Ç–≤–µ—Ç –Ω–∞ —Ç–∏–∫–µ—Ç
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ç–∏–∫–µ—Ç–∞—Ö –∏ –æ—Ç–≤–µ—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- File locking –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∑–∞–ø–∏—Å–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- –ü–æ–ª—è: `priority`, `assigned_to`, `responses`
- –°–æ—Å—Ç–æ—è–Ω–∏—è: `open`, `in_progress`, `closed`
- Timeout –¥–ª—è FSM (5 –º–∏–Ω—É—Ç)

### üéÆ –†–∞–∑–¥–µ–ª "–ò–≥—Ä—ã"

**3 –∏–≥—Ä—ã:**

1. **üé≤ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ**
   - –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10
   - –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏: 10, 25, 50, 100 –º–æ–Ω–µ—Ç
   - –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 3
   - –ù–∞–≥—Ä–∞–¥–∞ XP: 50 –∑–∞ –ø–æ–±–µ–¥—É, 5 –∑–∞ –ø—Ä–æ–∏–≥—Ä—ã—à

2. **üß† –ö–≤–∏–∑**
   - –°–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏–∑ 8 –≤–æ–ø—Ä–æ—Å–æ–≤
   - –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏: 10, 25, 50, 100 –º–æ–Ω–µ—Ç
   - –í—ã–∏–≥—Ä—ã—à: —Å—Ç–∞–≤–∫–∞ √ó 2
   - –ù–∞–≥—Ä–∞–¥–∞ XP: 30 –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, 5 –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

3. **üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω**
   - –ë–µ—Å–ø–ª–∞—Ç–Ω–æ, 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞
   - –ù–∞–≥—Ä–∞–¥—ã:
     - üí∞ 10-200 –º–æ–Ω–µ—Ç (—Ä–∞–∑–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
     - üíé 50 XP
     - üéâ –î–ñ–ï–ö–ü–û–¢ - 500 –º–æ–Ω–µ—Ç + 100 XP
   - –°–∏—Å—Ç–µ–º–∞ –≤–µ—Å–æ–≤ –¥–ª—è —á–µ—Å—Ç–Ω–æ–π —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞–≤–∫–æ–π
- –ö—É–ª–¥–∞—É–Ω—ã (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä: —Å—ã–≥—Ä–∞–Ω–æ, –≤—ã–∏–≥—Ä–∞–Ω–æ, –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ XP/coins —á–µ—Ä–µ–∑ database.py
- –û—Ç–º–µ–Ω–∞ –∏–≥—Ä—ã —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ç–∞–≤–∫–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
TTFD-Telegram/
‚îú‚îÄ‚îÄ main.py                    # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - ConversationHandlers
‚îú‚îÄ‚îÄ database.py                # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - –ø–æ–ª—è –¥–ª—è –∏–≥—Ä
‚îú‚îÄ‚îÄ config.py                  # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ commands.py            # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - –∫–Ω–æ–ø–∫–∞ –∏–≥—Ä
‚îÇ   ‚îú‚îÄ‚îÄ buttons.py             # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - —Ä–æ—É—Ç–∏–Ω–≥ —Ç–∏–∫–µ—Ç–æ–≤/–∏–≥—Ä
‚îÇ   ‚îú‚îÄ‚îÄ messages.py            # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ admin.py               # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ tickets.py             # üÜï –ù–û–í–´–ô - FSM —Ç–∏–∫–µ—Ç-—Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ games.py               # üÜï –ù–û–í–´–ô - FSM –∏–≥—Ä
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ tickets.py             # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - file locking, –Ω–æ–≤—ã–µ –ø–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ games.py               # üÜï –ù–û–í–´–ô - –ª–æ–≥–∏–∫–∞ –∏–≥—Ä
‚îÇ   ‚îî‚îÄ‚îÄ shop.py                # ‚úÖ –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ user_data.json         # –ë–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ tickets.json           # –ë–∞–∑–∞ —Ç–∏–∫–µ—Ç–æ–≤
    ‚îî‚îÄ‚îÄ shop.json              # –ë–∞–∑–∞ –º–∞–≥–∞–∑–∏–Ω–∞
```

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è callback_data:

```python
# –¢–∏–∫–µ—Ç—ã
ticket_create_start
ticket_cat_{category}
ticket_pri_{priority}
ticket_confirm_yes
ticket_cancel
ticket_my_list
ticket_view_{id}
ticket_reply_{id}
ticket_close_{id}
ticket_admin_panel
ticket_admin_list_{status}
ticket_admin_view_{id}
ticket_admin_assign_{id}

# –ò–≥—Ä—ã
game_menu
game_stats
game_guess_start
game_guess_bet_{amount}
game_guess_num_{number}
game_guess_cancel
game_quiz_start
game_quiz_bet_{amount}
game_quiz_ans_{index}
game_quiz_cancel
game_spin_start
game_spin_do
```

## Edge-cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:

‚úÖ –û—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è - –∫–Ω–æ–ø–∫–∞ "‚ùå –û—Ç–º–µ–Ω–∞" –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
‚úÖ –¢–∞–π–º–∞—É—Ç - ConversationHandler —Å timeout (5 –º–∏–Ω –¥–ª—è —Ç–∏–∫–µ—Ç–æ–≤, 3 –º–∏–Ω –¥–ª—è –∏–≥—Ä)
‚úÖ –ù–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥ - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è (10-1000 —Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º
‚úÖ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞–≤–∫–æ–π
‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–ø–∏—Å–∏ JSON - file locking (fcntl –Ω–∞ Linux, msvcrt –Ω–∞ Windows)
‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∏–≥—Ä—ã

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
cd TTFD-Telegram
python main.py
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- `/start` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Ç–µ–ø–µ—Ä—å —Å –∫–Ω–æ–ø–∫–æ–π "üéÆ –ò–≥—Ä—ã")
- `/help` - –°–ø—Ä–∞–≤–∫–∞
- `/profile` - –ü—Ä–æ—Ñ–∏–ª—å
- `/daily` - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞
- `/leaderboard` - –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤

**–¢–∏–∫–µ—Ç—ã:**
- `/ticket` - –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
- `/mytickets` - –ú–æ–∏ —Ç–∏–∫–µ—Ç—ã

**–ê–¥–º–∏–Ω:**
- `/admin` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `/broadcast <—Ç–µ–∫—Å—Ç>` - –†–∞—Å—Å—ã–ª–∫–∞

**–ò–≥—Ä—ã:**
- –ß–µ—Ä–µ–∑ –º–µ–Ω—é "üéÆ –ò–≥—Ä—ã" –≤ `/start`

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### –¢–∏–∫–µ—Ç—ã:
1. –°–æ–∑–¥–∞–π —Ç–∏–∫–µ—Ç —á–µ—Ä–µ–∑ –º–µ–Ω—é ‚Üí –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Üí –≤–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç ‚Üí –≤—ã–±–µ—Ä–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏
2. –ü—Ä–æ–≤–µ—Ä—å "–ú–æ–∏ —Ç–∏–∫–µ—Ç—ã" - —Ç–∏–∫–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–º
3. –ê–¥–º–∏–Ω: –∑–∞–π–¥–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí —Ç–∏–∫–µ—Ç—ã ‚Üí –ø–æ—Å–º–æ—Ç—Ä–∏ —Å–ø–∏—Å–æ–∫
4. –ê–¥–º–∏–Ω: –≤–æ–∑—å–º–∏ —Ç–∏–∫–µ—Ç –≤ —Ä–∞–±–æ—Ç—É ‚Üí –æ—Ç–≤–µ—Ç—å –Ω–∞ –Ω–µ–≥–æ
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø–æ–ª—É—á–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –æ—Ç–≤–µ—Ç—å –Ω–∞ —Ç–∏–∫–µ—Ç
6. –ó–∞–∫—Ä–æ–π —Ç–∏–∫–µ—Ç

### –ò–≥—Ä—ã:
1. –ó–∞–π–¥–∏ –≤ "üéÆ –ò–≥—Ä—ã"
2. –°—ã–≥—Ä–∞–π –≤ "–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ" - –≤—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É, —É–≥–∞–¥–∞–π —á–∏—Å–ª–æ
3. –°—ã–≥—Ä–∞–π –≤ "–ö–≤–∏–∑" - –≤—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É, –æ—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å
4. –ö—Ä—É—Ç–∏ "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–ø–∏–Ω" - –ø–æ–ª—É—á–∏ –Ω–∞–≥—Ä–∞–¥—É
5. –ü–æ–ø—Ä–æ–±—É–π –∫—Ä—É—Ç–∏—Ç—å —Å–ø–∏–Ω –µ—â—ë —Ä–∞–∑ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ (–∫—É–ª–¥–∞—É–Ω 24 —á–∞—Å–∞)
6. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä

## –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ SQLite (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

–ï—Å–ª–∏ JSON —Å—Ç–∞–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º–æ–π (–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–ø–∏—Å–∏), –º–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ SQLite:

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
1. –°–æ–∑–¥–∞—Ç—å `database_sqlite.py` —Å SQLAlchemy –∏–ª–∏ sqlite3
2. –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `migrate_to_sqlite.py`
3. –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ handlers

–ü–æ–∫–∞ JSON —Å file locking –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –æ—Ç–ª–∏—á–Ω–æ!

## –í–µ—Ä—Å–∏—è:

**v2.1** - –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ç–∏–∫–µ—Ç-—Å–∏—Å—Ç–µ–º–∞ + –ò–≥—Ä—ã

---

‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

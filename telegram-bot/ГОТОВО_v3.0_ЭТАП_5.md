# ‚úÖ –ì–û–¢–û–í–û: –≠—Ç–∞–ø 5 - AI –∏ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Job Scheduler
**–§–∞–π–ª:** `application/jobs/scheduler.py`

**–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:**
- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–µ—Å–µ—Ç** (00:00) - —Å–±—Ä–æ—Å –¥–µ–π–ª–∏–∫–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 09:00) - —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä
- **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (03:00) - —É–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —Ç–∏–∫–µ—Ç–æ–≤

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- APScheduler (AsyncIOScheduler)
- CronTrigger –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
scheduler = JobScheduler(user_service, game_service)
scheduler.setup_jobs()
scheduler.start()
```

### 2. AI Service
**–§–∞–π–ª:** `infrastructure/external/ai_service.py`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ç–∏–∫–µ—Ç—ã** - —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Å–∞–ø–ø–æ—Ä—Ç–∞
- **–ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–≤–∏–∑–∞** - AI —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- **–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- OpenAI API (GPT-3.5-turbo)
- Graceful degradation (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ AI)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
ai_service = AIService(api_key='sk-...')

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ç–∏–∫–µ—Ç
draft = await ai_service.generate_support_response(
    ticket_subject="–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ /profile",
    ticket_category="technical"
)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–∞ –∫–≤–∏–∑–∞
quiz = await ai_service.generate_quiz_question(difficulty='medium')

# –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
result = await ai_service.moderate_content("–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è")
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç—Ç–∞–ø–∞ 5

**–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 4  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~350  
**–§–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á:** 3  
**AI —Ñ—É–Ω–∫—Ü–∏–π:** 4  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** 2 (apscheduler, openai)  

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### requirements.txt
```
python-telegram-bot==20.7
python-dotenv==1.0.0
asyncpg==0.29.0
redis==5.0.1
pydantic==2.5.0
apscheduler==3.10.4
openai==1.6.1  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

### .env
```bash
# OpenAI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=sk-...

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/ttfd_bot

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
REDIS_URL=redis://localhost:6379/0
```

---

## üöÄ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ä–µ—Å–µ—Ç (00:00)
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–æ–≤ –¥–µ–π–ª–∏–∫–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–æ–≤–æ–º—É –¥–Ω—é

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00

### 2. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ü–Ω 09:00)
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä –∑–∞ –Ω–µ–¥–µ–ª—é
- –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤ –∞–¥–º–∏–Ω–∞–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 09:00

### 3. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (03:00)
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00

---

## ü§ñ AI —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ç–∏–∫–µ—Ç—ã
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
draft = await ai_service.generate_support_response(
    ticket_subject="–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ /profile",
    ticket_category="technical"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞..."
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å–∞–ø–ø–æ—Ä—Ç–∞
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω

### 2. –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
analysis = await ai_service.analyze_user_behavior({
    'total_games': 150,
    'last_active_days': 2
})
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {'activity_level': 'high', 'engagement': 'active'}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –í—ã—è–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –æ—Ç—Ç–æ–∫–∞
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—ã—Ç–∞

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∫–≤–∏–∑–∞
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
quiz = await ai_service.generate_quiz_question(difficulty='medium')
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {'question': '...', 'options': [...], 'correct': 1}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–º—ã

### 4. –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
result = await ai_service.moderate_content("–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {'flagged': False, 'categories': {...}}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å—Ä–µ–¥–∞

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –î–æ–±–∞–≤–∏—Ç—å OPENAI_API_KEY (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=sk-...
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º
```python
# –í main_v3.py –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ:
scheduler = JobScheduler(user_service, game_service)
scheduler.setup_jobs()
scheduler.start()
```

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI
```python
# –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç
# –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å AI-—á–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç–≤–µ—Ç–∞
# (–µ—Å–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ AdminTicketHandler)
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
application/
  jobs/
    __init__.py
    scheduler.py           # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

infrastructure/
  external/
    __init__.py
    ai_service.py          # AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

requirements.txt           # –û–±–Ω–æ–≤–ª—ë–Ω
.env.example              # –û–±–Ω–æ–≤–ª—ë–Ω
```

---

## ‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main_v3.py

```python
from application.jobs import JobScheduler
from infrastructure.external import AIService

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
ai_service = AIService()
scheduler = JobScheduler(user_service, game_service)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫
scheduler.setup_jobs()
scheduler.start()

# –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
scheduler.shutdown()
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á** - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∑–∞–¥–∞—á
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ —Å–±–æ—è—Ö
4. **–ú–µ—Ç—Ä–∏–∫–∏** - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å

### –î–ª—è AI
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
2. **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API
3. **Fallback** - —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ AI –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
4. **–°—Ç–æ–∏–º–æ—Å—Ç—å** - –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. **API –∫–ª—é—á–∏** - —Ö—Ä–∞–Ω–∏—Ç—å –≤ .env, –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å
2. **–ú–æ–¥–µ—Ä–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å AI-–æ—Ç–≤–µ—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
3. **–õ–æ–≥–∏** - –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [x] –°–æ–∑–¥–∞—Ç—å JobScheduler
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 3 —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- [x] –°–æ–∑–¥–∞—Ç—å AIService
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 4 AI —Ñ—É–Ω–∫—Ü–∏–∏
- [x] –û–±–Ω–æ–≤–∏—Ç—å requirements.txt
- [x] –û–±–Ω–æ–≤–∏—Ç—å .env.example
- [x] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ main_v3.py (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI —Ñ—É–Ω–∫—Ü–∏–∏

---

## üéâ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

**–≠—Ç–∞–ø 5 –∑–∞–≤–µ—Ä—à—ë–Ω!**
- –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- AI –ø–æ–º–æ–≥–∞–µ—Ç –≤ —Å–∞–ø–ø–æ—Ä—Ç–µ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- Graceful degradation - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ AI

---

**–î–∞—Ç–∞:** 08.02.2026  
**–í–µ—Ä—Å–∏—è:** v3.0  
**–≠—Ç–∞–ø:** 5 –∏–∑ 5  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω  
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 100% (5 –∏–∑ 5 —ç—Ç–∞–ø–æ–≤)

**üéä v3.0 –ì–û–¢–û–í!**

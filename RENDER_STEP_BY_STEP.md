# 📖 Пошаговая инструкция: Деплой на Render

## 🎯 Цель
Обновить сайт на Render с последними изменениями из GitHub.

---

## 📋 Шаг 1: Открой Render Dashboard

1. Открой браузер
2. Перейди на: **https://dashboard.render.com**
3. Войди в свой аккаунт (если не вошел)

**Что увидишь:**
```
┌─────────────────────────────────────┐
│ Render Dashboard                    │
├─────────────────────────────────────┤
│ Services:                           │
│  • TTFD (Web Service)              │
│    Status: Live                     │
│    Last deploy: 2 days ago          │
└─────────────────────────────────────┘
```

---

## 📋 Шаг 2: Открой проект TTFD

1. Кликни на **"TTFD"** в списке сервисов
2. Откроется страница проекта

**Что увидишь:**
```
┌─────────────────────────────────────┐
│ TTFD                                │
├─────────────────────────────────────┤
│ Status: ● Live                      │
│ URL: ttfd.onrender.com             │
│                                     │
│ Latest Deploy:                      │
│ • Commit: 08df578                   │
│ • Branch: main                      │
│ • Time: 2 days ago                  │
│                                     │
│ [Manual Deploy ▼]  [Settings]      │
└─────────────────────────────────────┘
```

---

## 📋 Шаг 3: Запусти Manual Deploy

1. Найди кнопку **"Manual Deploy"** (справа вверху)
2. Кликни на неё
3. Откроется выпадающее меню

**Меню:**
```
┌─────────────────────────────────┐
│ Manual Deploy                   │
├─────────────────────────────────┤
│ • Deploy latest commit          │
│ • Clear build cache & deploy    │
└─────────────────────────────────┘
```

4. Выбери **"Deploy latest commit"**

---

## 📋 Шаг 4: Подтверди деплой

1. Появится окно подтверждения
2. Проверь информацию:
   - Branch: **main**
   - Latest commit: **e273ee7**
3. Нажми **"Deploy"**

**Окно подтверждения:**
```
┌─────────────────────────────────────┐
│ Deploy TTFD                         │
├─────────────────────────────────────┤
│ Branch: main                        │
│ Commit: e273ee7                     │
│ Message: feat: добавлена система... │
│                                     │
│ [Cancel]  [Deploy]                  │
└─────────────────────────────────────┘
```

---

## 📋 Шаг 5: Дождись завершения

1. Начнется процесс деплоя
2. Статус изменится на **"Deploying..."**
3. Можешь смотреть логи в реальном времени

**Процесс деплоя:**
```
┌─────────────────────────────────────┐
│ Deploying...                        │
├─────────────────────────────────────┤
│ ● Building...                       │
│   Installing dependencies           │
│   Running build command             │
│                                     │
│ Logs:                               │
│ > pip install -r requirements.txt   │
│ > Collecting Flask...               │
│ > Successfully installed Flask      │
└─────────────────────────────────────┘
```

**Время:** обычно 2-5 минут

---

## 📋 Шаг 6: Проверь статус

1. Дождись когда статус станет **"Live"**
2. Проверь что коммит обновился на **e273ee7**

**После деплоя:**
```
┌─────────────────────────────────────┐
│ TTFD                                │
├─────────────────────────────────────┤
│ Status: ● Live                      │
│                                     │
│ Latest Deploy:                      │
│ • Commit: e273ee7 ✅                │
│ • Branch: main                      │
│ • Time: just now                    │
│                                     │
│ Deploy successful!                  │
└─────────────────────────────────────┘
```

---

## 📋 Шаг 7: Проверь сайт

1. Открой сайт: **https://ttfd.onrender.com**
2. Очисти кеш браузера: **Ctrl + Shift + R**
3. Проверь изменения

**Что проверить:**

### 1. Страница входа (`/login`)
```
Должно быть:
┌─────────────────────────────────┐
│ TTFD                            │
│ Войди через Discord             │
│                                 │
│ [🎮 Войти через Discord]        │
│                                 │
│ 🎮 Зачем входить?              │
│ • Сохраняй свой прогресс       │
│ • Участвуй в таблице лидеров   │
└─────────────────────────────────┘

НЕ должно быть:
❌ Формы логин/пароль
❌ Кнопки "Регистрация"
```

### 2. Главная страница (`/`)
```
Онлайн пользователи:
┌─────────────────────────────────┐
│ 👥 Онлайн на сервере (3)       │
├─────────────────────────────────┤
│ [👤 User1] ← кликабельно!      │
│ [👤 User2] ← кликабельно!      │
│ [👤 User3] ← кликабельно!      │
└─────────────────────────────────┘

При клике → открывается профиль
```

### 3. API endpoints
```
GET /api/user_by_discord/123456789
→ Должен вернуть JSON с username
```

---

## ✅ Готово!

Если всё работает:
- ✅ Деплой успешен
- ✅ Изменения применились
- ✅ Сайт обновлен

---

## ⚠️ Если что-то не так

### Проблема 1: Деплой падает с ошибкой

**Решение:**
1. Открой **Logs** на странице деплоя
2. Найди ошибку (обычно красным цветом)
3. Частые причины:
   - Отсутствует зависимость в `requirements.txt`
   - Синтаксическая ошибка в коде
   - Проблема с переменными окружения

**Проверь переменные:**
- Settings → Environment
- Должны быть: `DISCORD_TOKEN`, `SECRET_KEY`, и т.д.

### Проблема 2: Сайт не обновился

**Решение:**
1. Очисти кеш браузера: `Ctrl + Shift + R`
2. Открой в режиме инкогнито: `Ctrl + Shift + N`
3. Проверь что деплой действительно завершился
4. Проверь что коммит `e273ee7` в Latest Deploy

### Проблема 3: Auto-Deploy не работает

**Решение:**
1. Settings → Auto-Deploy
2. Убедись что включено: **Yes**
3. Проверь GitHub webhook:
   - GitHub → Settings → Webhooks
   - Должен быть webhook от Render
   - Status: ✅ (зеленая галочка)

---

## 🔄 Настройка Auto-Deploy (чтобы не делать вручную)

### Шаг 1: Включи Auto-Deploy

1. Dashboard → TTFD → Settings
2. Найди **"Auto-Deploy"**
3. Установи: **Yes**
4. Branch: **main**
5. Сохрани

### Шаг 2: Проверь GitHub Webhook

1. GitHub → Репозиторий → Settings → Webhooks
2. Должен быть webhook:
   ```
   Payload URL: https://api.render.com/deploy/...
   Content type: application/json
   Events: Just the push event
   Active: ✅
   ```

3. Если нет - создай:
   - Add webhook
   - Payload URL: скопируй из Render (Settings → Deploy Hook)
   - Content type: `application/json`
   - Events: "Just the push event"
   - Active: ✅

### Шаг 3: Проверь работу

1. Сделай любое изменение в коде
2. Закоммить и push на GitHub
3. Render должен автоматически начать деплой
4. Проверь в Dashboard → TTFD

---

## 📞 Дополнительная помощь

**Документация:**
- `RENDER_DEPLOY_FIX.md` - детальное руководство
- `RENDER_QUICK_FIX.md` - быстрое решение

**Утилиты:**
- `CHECK_RENDER.bat` - автоматическая проверка

**Render Support:**
- https://render.com/docs
- https://community.render.com

---

**Дата:** 29 января 2026  
**Коммит:** e273ee7  
**Статус:** Готов к деплою ✅

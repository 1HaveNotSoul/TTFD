# ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /getcode –†–ê–ë–û–¢–ê–ï–¢!

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: PostgreSQL –Ω–µ –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å dict
**–û—à–∏–±–∫–∞:**
```
psycopg2.ProgrammingError: can't adapt type 'dict'
```

**–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å Python —Å–ª–æ–≤–∞—Ä—å –≤ –∫–æ–ª–æ–Ω–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é JSONB –∫–æ–ª–æ–Ω–∫—É `game_stats` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–∏–≤—è–∑–∫–∏.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–≤—è–∑–∫–∏
**–û—à–∏–±–∫–∞:** –ú–µ—Ç–æ–¥—ã `get_telegram_link()`, `link_telegram()`, `unlink_telegram()` –Ω–µ –±—ã–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `database_postgres.py`.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã.

---

## üìù –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/getcode`
**–§–∞–π–ª:** `TTFD/discord-bot/py/slash_commands.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ game_stats (JSONB –∫–æ–ª–æ–Ω–∫–∞)
game_stats = user.get('game_stats', {})
if isinstance(game_stats, str):
    game_stats = json.loads(game_stats)

game_stats['link_code'] = {
    'code': code,
    'created_at': datetime.now().isoformat(),
    'expires_at': (datetime.now() + timedelta(minutes=3)).isoformat(),
    'used': False
}

user['game_stats'] = json.dumps(game_stats)
db.save_user(discord_id, user)
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –ø—Ä–∏–≤—è–∑–∫–∏ –≤ database_postgres.py
**–§–∞–π–ª:** `TTFD/discord-bot/py/database_postgres.py`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

#### `get_telegram_link(discord_id)`
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π Telegram ID –¥–ª—è Discord –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### `link_telegram(discord_id, telegram_id)`
–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç –∫ Discord. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∫–æ–ª–æ–Ω–∫—É `telegram_id` –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç.

#### `unlink_telegram(discord_id)`
–û—Ç–≤—è–∑–∞—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç –æ—Ç Discord.

#### `get_link_code(discord_id)`
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ –∏–∑ `game_stats`.

#### `verify_link_code(code)`
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ –∏ –≤–µ—Ä–Ω—É—Ç—å Discord ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ö–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –∏—Å—Ç—ë–∫ (3 –º–∏–Ω—É—Ç—ã)

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≤—è–∑–∫–∏

### –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –≤ Discord
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `/getcode` –≤ Discord
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (A-Z, 2-9, –±–µ–∑ –ø–æ—Ö–æ–∂–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
3. –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `game_stats['link_code']` —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è
4. –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –õ–° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ Telegram
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/code ABC123` –≤ Telegram –±–æ—Ç–µ
2. Telegram –±–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `db.verify_link_code(code)`
3. –ï—Å–ª–∏ –∫–æ–¥ –≤–∞–ª–∏–¥–µ–Ω - –ø–æ–ª—É—á–∞–µ—Ç Discord ID
4. –í—ã–∑—ã–≤–∞–µ—Ç `db.link_telegram(discord_id, telegram_id)`
5. –ê–∫–∫–∞—É–Ω—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã! üéâ

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏
- `/checklink` –≤ Discord - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–≤—è–∑–∫–∏
- `/unlink` –≤ Discord - –æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç –∞–∫–∫–∞—É–Ω—Ç—ã

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ users (PostgreSQL)
```sql
CREATE TABLE users (
    id TEXT PRIMARY KEY,
    username TEXT,
    xp INTEGER,
    coins INTEGER,
    ...
    game_stats JSONB,  -- –ó–¥–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—Å—è link_code
    telegram_id TEXT   -- –ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π Telegram ID (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ link_code –≤ game_stats
```json
{
    "link_code": {
        "code": "ABC123",
        "created_at": "2026-02-09T10:33:00",
        "expires_at": "2026-02-09T10:36:00",
        "used": false
    }
}
```

---

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –≠–ª–µ–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| –ö–æ–º–∞–Ω–¥–∞ `/getcode` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ö–æ–º–∞–Ω–¥–∞ `/checklink` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ö–æ–º–∞–Ω–¥–∞ `/unlink` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ú–µ—Ç–æ–¥—ã –ë–î | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã |
| PostgreSQL —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –ó–∞–ª–∏—Ç–æ –Ω–∞ GitHub | ‚úÖ –î–∞ (–∫–æ–º–º–∏—Ç 187afda) |
| Railway –¥–µ–ø–ª–æ–π | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ |

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è Railway (5-10 –º–∏–Ω—É—Ç)
Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub.

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
```
/getcode - –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –≤ –õ–°
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º
Telegram –±–æ—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –º–µ—Ç–æ–¥—ã:
- `db.verify_link_code(code)` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
- `db.link_telegram(discord_id, telegram_id)` - –ø—Ä–∏–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã

---

## üéâ –í—ã–≤–æ–¥

–ö–æ–º–∞–Ω–¥–∞ `/getcode` **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢**! –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ PostgreSQL —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –ú–µ—Ç–æ–¥—ã –ø—Ä–∏–≤—è–∑–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è –Ω–∞ Railway –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!

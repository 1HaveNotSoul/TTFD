<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - TTFD</title>
    <link rel="stylesheet" href="/static/css/main.css?v=3.0">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–º–∏—É–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .file-upload {
            position: relative;
            display: block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }
        
        .file-upload-label {
            display: block;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px dashed rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            text-align: center;
            color: #667eea;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover .file-upload-label {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.2);
        }
        
        .preview {
            margin-top: 16px;
            text-align: center;
        }
        
        .preview img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .preview audio {
            width: 100%;
            max-width: 400px;
            margin-top: 12px;
            border-radius: 50px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-group .btn {
            flex: 1;
            min-width: 150px;
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h1>
            <p>–ù–∞—Å—Ç—Ä–æ–π —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∫ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è</p>
        </div>

        <div class="nav">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/profile/{{ current_user.username }}">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
            <a href="/game">üéÆ –ö–ª–∏–∫–µ—Ä</a>
            <a href="/games">üéÆ –ò–≥—Ä—ã</a>
            <a href="/logout">–í—ã—Ö–æ–¥</a>
        </div>

        <div id="message" class="message"></div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ Email –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
        <div class="settings-grid">
            <div class="card">
                <h2>üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <form id="profileForm">
                    <div class="form-group">
                        <label>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                        <input type="text" id="display_name" value="{{ current_user.display_name }}" required>
                    </div>
                    
                    <div class="form-group">
                        <label>–õ–æ–≥–∏–Ω (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)</label>
                        <input type="text" value="{{ current_user.username }}" disabled>
                    </div>
                    
                    <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>

            <div class="card">
                <h2>üìù –û —Å–µ–±–µ</h2>
                <form id="bioForm">
                    <div class="form-group">
                        <label>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</label>
                        <textarea id="bio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ...">{{ current_user.profile.bio if current_user.profile else '' }}</textarea>
                        <small>–ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤</small>
                    </div>
                    
                    <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∏–æ–≥—Ä–∞—Ñ–∏—é</button>
                </form>
            </div>
        </div>

        <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è -->
        <div class="card">
            <h2>üé® –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</h2>
            <form id="themeForm">
                <div class="form-group">
                    <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ —Å–∞–π—Ç–∞</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="color" id="bg_color" value="{{ current_user.profile.bg_color if current_user.profile and current_user.profile.bg_color else '#667eea' }}" style="width: 80px; height: 50px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer;">
                        <input type="text" id="bg_color_text" value="{{ current_user.profile.bg_color if current_user.profile and current_user.profile.bg_color else '#667eea' }}" placeholder="#667eea" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace;">
                        <button type="button" class="btn btn-secondary" onclick="resetColor()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                    <small>–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–∞</small>
                </div>
                
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–º—É</button>
            </form>
            
            <hr style="margin: 30px 0; border: none; border-top: 1px solid #e0e0e0;">
            
            <h3 style="margin-bottom: 15px;">üñºÔ∏è –§–æ–Ω (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–≤–∏–¥–µ–æ/GIF)</h3>
            <form id="backgroundForm">
                <div class="form-group">
                    <div class="file-upload">
                        <input type="file" id="background_file" accept="image/*,video/*,.gif">
                        <label class="file-upload-label">
                            üñºÔ∏è –ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å<br>
                            <small>JPG, PNG, GIF, MP4, WEBM (–º–∞–∫—Å. 50MB)</small>
                        </label>
                    </div>
                    <small>–ó–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, GIF –∏–ª–∏ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–æ–Ω–∞. –ë—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö.</small>
                    {% if current_user.profile and current_user.profile.background_url %}
                    <div class="preview" style="margin-top: 15px;">
                        {% if current_user.profile.background_type == 'video' %}
                        <video style="width: 100%; max-width: 400px; border-radius: 12px;" controls>
                            <source src="{{ current_user.profile.background_url }}">
                        </video>
                        {% else %}
                        <img src="{{ current_user.profile.background_url }}" style="width: 100%; max-width: 400px; border-radius: 12px;">
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <button type="submit" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</button>
            </form>
        </div>

        <div class="settings-grid">
        </div>

        <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –∏ –ú—É–∑—ã–∫–∞ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
        <div class="settings-grid">
            <div class="card">
                <h2>üì∏ –ê–≤–∞—Ç–∞—Ä–∫–∞</h2>
                <form id="avatarForm">
                    <div class="form-group">
                        <div class="file-upload">
                            <input type="file" id="avatar_file" accept="image/*">
                            <label class="file-upload-label">
                                üì∏ –ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å<br>
                                <small>JPG, PNG, GIF (–º–∞–∫—Å. 5MB)</small>
                            </label>
                        </div>
                        {% if current_user.profile and current_user.profile.avatar_url %}
                        <div class="preview">
                            <img src="{{ current_user.profile.avatar_url }}" alt="Avatar">
                        </div>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
                </form>
            </div>

            <div class="card">
                <h2>üéµ –ú—É–∑—ã–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                <form id="musicForm">
                    <div class="form-group">
                        <div class="file-upload">
                            <input type="file" id="music_file" accept="audio/mp3,audio/mpeg">
                            <label class="file-upload-label">
                                üéµ –ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å<br>
                                <small>MP3 (–º–∞–∫—Å. 10MB)</small>
                            </label>
                        </div>
                        <small>–ú—É–∑—ã–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</small>
                        {% if current_user.profile and current_user.profile.music_url %}
                        <div class="preview">
                            <audio controls>
                                <source src="{{ current_user.profile.music_url }}" type="audio/mpeg">
                            </audio>
                        </div>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º—É–∑—ã–∫—É</button>
                </form>
            </div>
        </div>

        <!-- Discord –∏ –ü–∞—Ä–æ–ª—å –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
        <div class="settings-grid">
            <div class="card">
                <h2>üéÆ –ü—Ä–∏–≤—è–∑–∫–∞ Discord</h2>
                <form id="discordForm">
                    <div class="form-group">
                        <label>Discord ID</label>
                        <input type="text" id="discord_id" value="{{ current_user.discord_id or '' }}" 
                               placeholder="–¢–≤–æ–π Discord ID">
                        <small>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ ‚Üí –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ‚Üí –ü–ö–ú –Ω–∞ —Å–µ–±—è ‚Üí –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</small>
                    </div>
                    
                    <button type="submit" class="btn">–ü—Ä–∏–≤—è–∑–∞—Ç—å Discord</button>
                </form>
            </div>

            <div class="card">
                <h2>üîí –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
                <form id="passwordForm">
                    <div class="form-group">
                        <label>–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="old_password" required>
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new_password" required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label>–ü–æ–≤—Ç–æ—Ä–∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new_password2" required minlength="6">
                    </div>
                    
                    <button type="submit" class="btn btn-danger">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Profile update
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                display_name: document.getElementById('display_name').value
            };
            await updateProfile(data);
        });

        // Bio update
        document.getElementById('bioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                bio: document.getElementById('bio').value
            };
            await updateProfile(data);
        });

        // Theme update
        document.getElementById('themeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const bgColor = document.getElementById('bg_color').value;
            const data = {
                bg_color: bgColor
            };
            const result = await updateProfile(data);
            if (result) {
                // Apply immediately
                applyTheme(bgColor);
            }
        });

        // Color picker sync
        document.getElementById('bg_color').addEventListener('input', function(e) {
            document.getElementById('bg_color_text').value = e.target.value;
            // Live preview
            applyTheme(e.target.value);
        });

        document.getElementById('bg_color_text').addEventListener('input', function(e) {
            const color = e.target.value;
            if (/^#[0-9A-F]{6}$/i.test(color)) {
                document.getElementById('bg_color').value = color;
                applyTheme(color);
            }
        });

        function resetColor() {
            const defaultColor = '#667eea';
            document.getElementById('bg_color').value = defaultColor;
            document.getElementById('bg_color_text').value = defaultColor;
            applyTheme(defaultColor);
        }

        function applyTheme(color) {
            // Create gradient with user color
            const lighterColor = adjustColor(color, 20);
            document.body.style.background = `linear-gradient(135deg, ${color} 0%, ${lighterColor} 100%)`;
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        // Apply saved theme on load
        {% if current_user.profile and current_user.profile.bg_color %}
        applyTheme('{{ current_user.profile.bg_color }}');
        {% endif %}

        // Background upload
        document.getElementById('backgroundForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('background_file');
            
            if (!fileInput.files || !fileInput.files[0]) {
                showMessage('–í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                return;
            }
            
            // Check file size (50MB max)
            if (fileInput.files[0].size > 50 * 1024 * 1024) {
                showMessage('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 50MB', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('background', fileInput.files[0]);
            
            try {
                const response = await fetch('/api/upload_background', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ –§–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ–Ω–∞', 'error');
            }
        });

        // Avatar upload
        document.getElementById('avatarForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('avatar_file');
            
            if (!fileInput.files || !fileInput.files[0]) {
                showMessage('–í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                return;
            }
            
            // Check file size (5MB max)
            if (fileInput.files[0].size > 5 * 1024 * 1024) {
                showMessage('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('avatar', fileInput.files[0]);
            
            try {
                const response = await fetch('/api/upload_avatar', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ –ê–≤–∞—Ç–∞—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏', 'error');
            }
        });

        // Music upload
        document.getElementById('musicForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('music_file');
            
            if (!fileInput.files || !fileInput.files[0]) {
                showMessage('–í—ã–±–µ—Ä–∏ MP3 —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                return;
            }
            
            // Check file size (10MB max)
            if (fileInput.files[0].size > 10 * 1024 * 1024) {
                showMessage('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 10MB', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('music', fileInput.files[0]);
            
            try {
                const response = await fetch('/api/upload_music', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ –ú—É–∑—ã–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º—É–∑—ã–∫–∏', 'error');
            }
        });

        // Discord link
        document.getElementById('discordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const discord_id = document.getElementById('discord_id').value;
            
            if (!discord_id || discord_id.length < 17) {
                showMessage('–í–≤–µ–¥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Discord ID', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/link_discord', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({discord_id})
                });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ Discord —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!', 'success');
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ Discord', 'error');
            }
        });

        // Password change
        document.getElementById('passwordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const old_password = document.getElementById('old_password').value;
            const new_password = document.getElementById('new_password').value;
            const new_password2 = document.getElementById('new_password2').value;
            
            if (new_password !== new_password2) {
                showMessage('–ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            if (new_password.length < 6) {
                showMessage('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/change_password', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({old_password, new_password})
                });
                const data = await response.json();
                
                if (data.success) {
                    showMessage('‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω!', 'success');
                    document.getElementById('passwordForm').reset();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è', 'error');
            }
        });

        async function updateProfile(data) {
            try {
                const response = await fetch('/api/update_profile', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (result.success) {
                    showMessage('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
                    return true;
                } else {
                    showMessage(result.error, 'error');
                    return false;
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è', 'error');
                return false;
            }
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.className = 'message ' + type;
            msg.style.display = 'block';
            msg.textContent = text;
            window.scrollTo({top: 0, behavior: 'smooth'});
            setTimeout(() => {
                msg.style.display = 'none';
            }, 5000);
        }

        // File upload label update
        document.getElementById('avatar_file').addEventListener('change', function(e) {
            const label = this.parentElement.querySelector('.file-upload-label');
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                label.innerHTML = `‚úÖ ${file.name}<br><small>${sizeMB} MB</small>`;
            }
        });

        document.getElementById('music_file').addEventListener('change', function(e) {
            const label = this.parentElement.querySelector('.file-upload-label');
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                label.innerHTML = `‚úÖ ${file.name}<br><small>${sizeMB} MB</small>`;
            }
        });

        // Character counter for bio
        const bioTextarea = document.getElementById('bio');
        bioTextarea.addEventListener('input', function() {
            const maxLength = 500;
            const currentLength = this.value.length;
            if (currentLength > maxLength) {
                this.value = this.value.substring(0, maxLength);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - TTFD</title>
    <link rel="stylesheet" href="/static/css/main.css?v=4.0">
</head>
<body {% if current_user and current_user.profile %}data-user-color="{{ current_user.profile.bg_color or '#667eea' }}" {% if current_user.profile.background_url %}data-background-url="{{ current_user.profile.background_url }}" data-background-type="{{ current_user.profile.background_type or 'image' }}"{% endif %}{% endif %}>
    <div class="container"></div>
        <div class="header">
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p>–ù–∞—Å—Ç—Ä–æ–π —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å–∞–π—Ç</p>
        </div>

        <div class="nav">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/profile/{{ current_user.username }}">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
            <a href="/games">üéÆ –ò–≥—Ä—ã</a>
            <a href="/users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            <a href="/logout">–í—ã—Ö–æ–¥</a>
        </div>

        <div id="message" class="message"></div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card">
            <h2>üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <form id="profileForm" class="settings-form">
                <div class="form-group">
                    <label>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                    <input type="text" id="display_name" value="{{ current_user.display_name }}" required>
                </div>
                
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)</label>
                    <input type="text" value="{{ current_user.username }}" disabled>
                </div>
                
                <div class="form-group">
                    <label>–û —Å–µ–±–µ</label>
                    <textarea id="bio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ..." maxlength="500">{{ current_user.profile.bio if current_user.profile else '' }}</textarea>
                    <small>–ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤</small>
                </div>
                
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>

        <!-- –ë–õ–û–ö 1: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="card">
            <div class="card-header">
                <h2>üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h2>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ç–≤–æ—ë–º –ø—Ä–æ—Ñ–∏–ª–µ</p>
            </div>

            <div class="settings-grid">
                <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ -->
                <div class="settings-section">
                    <h3>üì∏ –ê–≤–∞—Ç–∞—Ä–∫–∞</h3>
                    <form id="avatarForm">
                        <div class="upload-area" id="avatarUploadArea">
                            <input type="file" id="avatar_file" accept="image/*" hidden>
                            <div class="upload-placeholder">
                                {% if current_user.profile and current_user.profile.avatar_url %}
                                <img src="{{ current_user.profile.avatar_url }}" alt="Avatar" class="preview-image">
                                {% else %}
                                <div class="upload-icon">üì∏</div>
                                <p>–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å</p>
                                <small>JPG, PNG, GIF (–º–∞–∫—Å. 5MB)</small>
                                {% endif %}
                            </div>
                            <div class="upload-progress" id="avatarProgress">
                                <div class="progress-bar"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</button>
                    </form>
                </div>

                <!-- –ú—É–∑—ã–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                <div class="settings-section">
                    <h3>üéµ –ú—É–∑—ã–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                    <form id="musicForm">
                        <div class="upload-area" id="musicUploadArea">
                            <input type="file" id="music_file" accept="audio/*" hidden>
                            <div class="upload-placeholder">
                                {% if current_user.profile and current_user.profile.music_url %}
                                <audio controls class="preview-audio">
                                    <source src="{{ current_user.profile.music_url }}" type="audio/mpeg">
                                </audio>
                                {% else %}
                                <div class="upload-icon">üéµ</div>
                                <p>–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å</p>
                                <small>MP3, WAV, OGG (–º–∞–∫—Å. 10MB)</small>
                                {% endif %}
                            </div>
                            <div class="upload-progress" id="musicProgress">
                                <div class="progress-bar"></div>
                            </div>
                        </div>
                        <small class="help-text">–ú—É–∑—ã–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</small>
                        <button type="submit" class="btn btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º—É–∑—ã–∫—É</button>
                    </form>
                </div>

                <!-- –§–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
                <div class="settings-section full-width">
                    <h3>üñºÔ∏è –§–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è</h3>
                    <p class="section-description">–ù–∞—Å—Ç—Ä–æ–π —Ñ–æ–Ω —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è - –≤—ã–±–µ—Ä–∏ —Ü–≤–µ—Ç –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                    
                    <div class="profile-bg-controls">
                        <div class="color-picker-group">
                            <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
                            <div class="color-input-group">
                                <input type="color" id="profile_bg_color" value="{{ current_user.profile.profile_bg_color if current_user.profile and current_user.profile.profile_bg_color else '#667eea' }}">
                                <input type="text" id="profile_bg_color_text" value="{{ current_user.profile.profile_bg_color if current_user.profile and current_user.profile.profile_bg_color else '#667eea' }}" placeholder="#667eea">
                                <button type="button" class="btn btn-small" onclick="resetProfileColor()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>

                        <div class="divider-text">–∏–ª–∏</div>

                        <form id="profileBgForm">
                            <div class="upload-area" id="profileBgUploadArea">
                                <input type="file" id="profile_bg_file" accept="image/*" hidden>
                                <div class="upload-placeholder">
                                    {% if current_user.profile and current_user.profile.profile_bg_url %}
                                    <img src="{{ current_user.profile.profile_bg_url }}" alt="Profile BG" class="preview-image-wide">
                                    {% else %}
                                    <div class="upload-icon">üñºÔ∏è</div>
                                    <p>–ó–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–æ–Ω–∞</p>
                                    <small>JPG, PNG, GIF (–º–∞–∫—Å. 10MB)</small>
                                    {% endif %}
                                </div>
                                <div class="upload-progress" id="profileBgProgress">
                                    <div class="progress-bar"></div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</button>
                        </form>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="saveProfileBg()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è</button>
                </div>
            </div>
        </div>

        <!-- –ë–õ–û–ö 2: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞ -->
        <div class="card">
            <div class="card-header">
                <h2>üé® –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–π—Ç–∞</h2>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–∞–π—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è)</p>
            </div>

            <div class="settings-section">
                <h3>üåà –¶–≤–µ—Ç —Ñ–æ–Ω–∞ —Å–∞–π—Ç–∞</h3>
                <form id="themeForm">
                    <div class="color-picker-group">
                        <div class="color-input-group">
                            <input type="color" id="bg_color" value="{{ current_user.profile.bg_color if current_user.profile and current_user.profile.bg_color else '#667eea' }}">
                            <input type="text" id="bg_color_text" value="{{ current_user.profile.bg_color if current_user.profile and current_user.profile.bg_color else '#667eea' }}" placeholder="#667eea">
                            <button type="button" class="btn btn-small" onclick="resetColor()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>
                        <small class="help-text">–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–∞</small>
                    </div>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–≤–µ—Ç</button>
                </form>

                <div class="divider-text">–∏–ª–∏</div>

                <h3>üñºÔ∏è –§–æ–Ω —Å–∞–π—Ç–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ/–≤–∏–¥–µ–æ/GIF)</h3>
                <form id="backgroundForm">
                    <div class="upload-area large" id="backgroundUploadArea">
                        <input type="file" id="background_file" accept="image/*,video/*" hidden>
                        <div class="upload-placeholder">
                            {% if current_user.profile and current_user.profile.background_url %}
                                {% if current_user.profile.background_type == 'video' %}
                                <video class="preview-video" controls>
                                    <source src="{{ current_user.profile.background_url }}">
                                </video>
                                {% else %}
                                <img src="{{ current_user.profile.background_url }}" alt="Background" class="preview-image-wide">
                                {% endif %}
                            {% else %}
                            <div class="upload-icon">üñºÔ∏è</div>
                            <p>–ó–∞–≥—Ä—É–∑–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, GIF –∏–ª–∏ –≤–∏–¥–µ–æ</p>
                            <small>JPG, PNG, GIF, MP4, WEBM (–º–∞–∫—Å. 50MB)</small>
                            {% endif %}
                        </div>
                        <div class="upload-progress" id="backgroundProgress">
                            <div class="progress-bar"></div>
                        </div>
                    </div>
                    <small class="help-text">–§–æ–Ω –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–∞–π—Ç–∞</small>
                    <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω</button>
                </form>
            </div>
        </div>

        <!-- Discord –∏ –ü–∞—Ä–æ–ª—å -->
        <div class="settings-grid">
            <div class="card">
                <h2>üéÆ –ü—Ä–∏–≤—è–∑–∫–∞ Discord</h2>
                <form id="discordForm" class="settings-form">
                    <div class="form-group">
                        <label>Discord ID</label>
                        <input type="text" id="discord_id" value="{{ current_user.discord_id or '' }}" placeholder="–¢–≤–æ–π Discord ID">
                        <small>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ ‚Üí –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ‚Üí –ü–ö–ú –Ω–∞ —Å–µ–±—è ‚Üí –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</small>
                    </div>
                    <button type="submit" class="btn btn-primary">–ü—Ä–∏–≤—è–∑–∞—Ç—å Discord</button>
                </form>
            </div>

            <div class="card">
                <h2>üîí –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h2>
                <form id="passwordForm" class="settings-form">
                    <div class="form-group">
                        <label>–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="old_password" required>
                    </div>
                    <div class="form-group">
                        <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new_password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–≤—Ç–æ—Ä–∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new_password2" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-danger">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </form>
            </div>
        </div>
    </div>

    <script src="/static/js/settings.js"></script>
    <script src="/static/js/theme.js"></script>
</body>
</html>

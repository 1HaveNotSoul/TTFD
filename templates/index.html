<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="/static/css/main.css?v=3.0">
</head>
<body {% if current_user and current_user.profile and current_user.profile.bg_color %}data-user-color="{{ current_user.profile.bg_color }}"{% endif %}>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Discord Bot</h1>
            <p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
        </div>
        <div class="nav">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/games">üéÆ –ò–≥—Ä—ã</a>
            <a href="/leaderboard">üèÜ –õ–∏–¥–µ—Ä—ã</a>
            <a href="/ranks">üìä –†–∞–Ω–≥–∏</a>
            {% if current_user %}
                <a href="/profile/{{ current_user.username }}">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                <a href="/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                <a href="/logout">–í—ã—Ö–æ–¥</a>
            {% else %}
                <a href="/login">–í—Ö–æ–¥</a>
                <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
        <div class="grid">
            <div class="card">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</h2>
                <div class="stat">
                    <span>–°—Ç–∞—Ç—É—Å:</span>
                    <span class="status {{ 'online' if bot_data.status == 'online' else 'offline' }}">
                        {{ '–û–Ω–ª–∞–π–Ω' if bot_data.status == 'online' else '–û—Ñ—Ñ–ª–∞–π–Ω' }}
                    </span>
                </div>
                <div class="stat"><span>‚è±Ô∏è –ê–ø—Ç–∞–π–º:</span><span class="stat-value" id="uptime">0—Å</span></div>
                <div class="stat"><span>üåê –°–µ—Ä–≤–µ—Ä–æ–≤:</span><span class="stat-value" id="guilds">{{ bot_data.guilds }}</span></div>
                <div class="stat"><span>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span><span class="stat-value" id="users">{{ bot_data.users }}</span></div>
                <div class="stat"><span>üìù –ö–æ–º–∞–Ω–¥:</span><span class="stat-value" id="commands">{{ bot_data.commands_used }}</span></div>
                <div class="stat"><span>üí¨ –°–æ–æ–±—â–µ–Ω–∏–π:</span><span class="stat-value" id="messages">{{ bot_data.messages_seen }}</span></div>
                <div class="stat"><span>üì° –ó–∞–¥–µ—Ä–∂–∫–∞:</span><span class="stat-value" id="latency">{{ bot_data.latency }}ms</span></div>
            </div>
            <div class="card">
                <h2>üë• –û–Ω–ª–∞–π–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (<span id="onlineCount">0</span>)</h2>
                <div class="online-list" id="onlineList"><p style="color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p></div>
            </div>
            <div class="card">
                <h2>üéÆ –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h2>
                <div class="quick-links">
                    <a href="/games" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üéÆ –í—Å–µ –∏–≥—Ä—ã</a>
                    <a href="/leaderboard" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</a>
                    <a href="/ranks" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">üìä –í—Å–µ —Ä–∞–Ω–≥–∏</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        function updateStats() {
            fetch('/api/stats').then(r => r.json()).then(data => {
                document.getElementById('uptime').textContent = formatUptime(data.uptime);
                document.getElementById('guilds').textContent = data.guilds;
                document.getElementById('users').textContent = data.users;
                document.getElementById('commands').textContent = data.commands_used;
                document.getElementById('messages').textContent = data.messages_seen;
                document.getElementById('latency').textContent = data.latency + 'ms';
            });
        }
        function updateOnline() {
            fetch('/api/online').then(r => r.json()).then(data => {
                document.getElementById('onlineCount').textContent = data.count;
                const list = document.getElementById('onlineList');
                if (data.members.length === 0) {
                    list.innerHTML = '<p style="color: #999;">–ù–∏–∫–æ–≥–æ –Ω–µ—Ç –æ–Ω–ª–∞–π–Ω</p>';
                    return;
                }
                list.innerHTML = data.members.map(m => `
                    <div class="online-member" data-discord-id="${m.id}" data-display-name="${m.display_name}" title="–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" style="cursor: pointer;">
                        <img src="${m.avatar}" alt="${m.display_name}">
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${m.display_name}</div>
                            <div style="font-size: 0.9em; color: #666;">${m.activity || '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏'}</div>
                        </div>
                        <div class="member-status ${m.status}"></div>
                    </div>
                `).join('');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
                document.querySelectorAll('.online-member').forEach(member => {
                    member.addEventListener('click', function() {
                        const discordId = this.getAttribute('data-discord-id');
                        const displayName = this.getAttribute('data-display-name');
                        openProfile(discordId, displayName);
                    });
                });
            });
        }
        
        async function openProfile(discordId, displayName) {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ username –ø–æ Discord ID
                const response = await fetch(`/api/user_by_discord/${discordId}`);
                const data = await response.json();
                
                if (data.success && data.has_account) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                    window.location.href = `/profile/${data.username}`;
                } else {
                    // –ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    alert(`–£ ${displayName} –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞ —Å–∞–π—Ç–µ.\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
            }
        }
        function formatUptime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h}—á ${m}–º ${s}—Å`;
        }
        updateStats(); updateOnline();
        setInterval(updateStats, 5000);
        setInterval(updateOnline, 10000);
    </script>
    <script src="/static/js/theme.js"></script>
</body>
</html>
